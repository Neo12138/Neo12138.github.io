var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Const=function(){function t(){}return t}();Const.SCREEN_WIDTH=0,Const.SCREEN_HEIGHT=0,Const.card={c0:14671839,c2:13427096,c4:8438377,c8:3322220,c16:1291697,c32:4491978,c64:6247072,c128:16289091,c256:15425792,c512:15681072,c1024:15073298,c2048:12586510,c4096:10747957,c8192:10747995,c16384:6946911,c32768:11891},Const.DIR={U:1,R:2,D:3,L:4},__reflect(Const.prototype,"Const");var Card=function(t){function e(){var e=t.call(this)||this;e.width=135,e.height=135,e.fgColor=16777215,e.bgColor=14671839;var i=new egret.Shape;i.graphics.beginFill(e.bgColor),i.graphics.drawRoundRect(0,0,e.width,e.height,30),i.graphics.endFill(),e.addChild(i),e.background=i;var r=new egret.TextField;return e.addChild(r),r.width=e.width,r.height=e.height,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,e.label=r,e}return __extends(e,t),e.prototype.display=function(t){this.bgColor=Const.card["c"+t];var e=this.background;e.graphics.beginFill(this.bgColor),e.graphics.drawRoundRect(0,0,this.width,this.height,30),e.graphics.endFill();var i=this.label;i.text=0==t?"":t.toString(),i.size=1e3>t?48:1e4>t?36:32},e.prototype.displayWithAnimation=function(t){this.bgColor=Const.card["c"+t];var e=this.background;e.graphics.beginFill(this.bgColor),e.graphics.drawRoundRect(0,0,this.width,this.height,30),e.graphics.endFill(),e.x=this.width/2,e.y=this.height/2,e.scaleX=0,e.scaleY=0;var i=egret.Tween.get(e);i.to({scaleX:1,scaleY:1,x:0,y:0},200);var r=this.label;r.text=0==t?"":t.toString(),r.size=1e3>t?48:1e4>t?36:32},e}(egret.Sprite);__reflect(Card.prototype,"Card");var SceneContainer=function(t){function e(){var i=t.call(this)||this;return e.gameScene=i,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.container=new egret.Sprite,this.addChild(this.container),this.entry()},e.prototype.entry=function(){this.removeAll();var t=new EntryView;this.container.addChild(t)},e.prototype.play=function(){this.removeAll();var t=new PlayView;this.container.addChild(t)},e.prototype.removeAll=function(){this.container.removeChildren()},e}(egret.Sprite);__reflect(SceneContainer.prototype,"SceneContainer");var ResourceLoader=function(){function t(){}return t.createBitmapByName=function(e){var i=new egret.Bitmap;return i.texture=t.createTextureByName(e),i},t.createTextureByName=function(e){if(-1==e.indexOf("."))return RES.getRes(e);var i=e.split(".")[0],r=e.split(".")[1];return t.createTexturesFromSheet(r,i)},t.createTexturesFromSheet=function(t,e){var i=RES.getRes(e);return i.getTexture(t)},t}();__reflect(ResourceLoader.prototype,"ResourceLoader");var EntryView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=ResourceLoader.createBitmapByName("bg_jpg");this.addChild(t),t.width=Const.SCREEN_WIDTH,t.height=Const.SCREEN_HEIGHT;var e=new egret.Shape;e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,Const.SCREEN_WIDTH,172),e.graphics.endFill(),e.y=33,this.addChild(e);var i=ResourceLoader.createBitmapByName("egret_icon_png");this.addChild(i),i.x=26,i.y=33;var r=new egret.Shape;r.graphics.lineStyle(2,16777215),r.graphics.moveTo(0,0),r.graphics.lineTo(0,117),r.graphics.endFill(),r.x=172,r.y=61,this.addChild(r);var a=new egret.TextField;a.textColor=16777215,a.width=Const.SCREEN_WIDTH-172,a.textAlign="center",a.text="2048",a.size=32,a.x=172,a.y=80,this.addChild(a);var o=new egret.TextField;o.textColor=13882323,o.width=Const.SCREEN_WIDTH-100,o.textAlign="center",o.text="制作于2017-07-15，王成保留所有权利",o.size=22,o.x=140,o.y=135,this.addChild(o);var n=ResourceLoader.createBitmapByName("start_btn");this.addChild(n),n.width=211,n.height=68,n.x=Const.SCREEN_WIDTH-n.width>>1,n.y=900,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this)},e.prototype.onStart=function(){SceneContainer.gameScene.play(),this.removeAll()},e.prototype.removeAll=function(){this.removeChildren()},e}(egret.Sprite);__reflect(EntryView.prototype,"EntryView");var PlayView=function(t){function e(){var e=t.call(this)||this;return e.curScore=0,e.init(),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.startMove,e),e.addEventListener(egret.TouchEvent.TOUCH_END,e.stopMove,e),e}return __extends(e,t),e.prototype.init=function(){var t=ResourceLoader.createBitmapByName("play_bg");this.addChild(t),t.width=Const.SCREEN_WIDTH,t.height=Const.SCREEN_HEIGHT;var e=ResourceLoader.createBitmapByName("top_bar");this.addChild(e),e.x=20,e.y=32,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this);var i=ResourceLoader.createBitmapByName("game_board");this.addChild(i),i.x=20,i.y=440,this.touchEnabled=!0;var r=new egret.TextField;this.addChild(r),r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.textColor=16777215,r.text="0",r.size=32,r.width=185,r.height=72,r.x=239,r.y=80,this.tfScore=r,this.start()},e.prototype.start=function(){this.curScore=0,this.initData(),this.generateRandNumber(),this.generateRandNumber()},e.prototype.initData=function(){this.data=new Array,this.cards=new Array,this.points=new Array;for(var t=0;4>t;t++){this.data[t]=new Array,this.cards[t]=new Array;for(var e=0;4>e;e++){this.data[t][e]=0;var i=new Card;i.x=32+147*e,i.y=452+147*t,this.addChild(i),this.cards[t][e]=i}}},e.prototype.generateRandNumber=function(){var t,e,i;if(!this.isFull(this.data)){var r=Math.floor(16*Math.random());for(t=Math.floor(r/4),e=r%4;;){if(0===this.data[t][e])break;r=Math.floor(16*Math.random()),t=Math.floor(r/4),e=r%4}i=Math.random()<.8?2:4,this.data[t][e]=i,this.cards[t][e].displayWithAnimation(i)}},e.prototype.startMove=function(t){this.startX=t.stageX,this.startY=t.stageY},e.prototype.stopMove=function(t){var e=t.stageX-this.startX,i=t.stageY-this.startY,r=180*Math.atan2(i,e)/Math.PI;r>-180&&-135>r&&(this.direction=Const.DIR.L),r>=-135&&-45>r&&(this.direction=Const.DIR.U),r>=-45&&45>r&&(this.direction=Const.DIR.R),r>=45&&135>r&&(this.direction=Const.DIR.D),r>=135&&180>=r&&(this.direction=Const.DIR.L),this.move()},e.prototype.move=function(){switch(this.direction){case Const.DIR.U:if(!this.isUpMovable(this.data))return;this.turnUp();break;case Const.DIR.R:if(!this.isRightMovable(this.data))return;this.turnRight();break;case Const.DIR.D:if(!this.isDownMovable(this.data))return;this.turnDown();break;case Const.DIR.L:if(!this.isLeftMovable(this.data))return;this.turnLeft()}this.updateCard(),this.generateRandNumber()},e.prototype.turnLeft=function(){for(var t=0,e=0;4>e;e++)for(var i=0,r=0;4>i;i++)if(0!==this.data[e][i]){var a=this.data[e][i];this.data[e][i]=0,this.data[e][r]=a;for(var o=i+1;4>o;o++)if(0!==this.data[e][o]){if(this.data[e][r]===this.data[e][o]){this.points.push({x:e,y:r}),this.data[e][r++]*=2,t+=this.data[e][r-1],this.data[e][o]=0,i=r;break}var n=this.data[e][o];this.data[e][o]=0,this.data[e][++r]=n,i=r}}this.curScore+=t},e.prototype.turnRight=function(){for(var t=0,e=0;4>e;e++)for(var i=3,r=3;i>=0;i--)if(0!==this.data[e][i]){var a=this.data[e][i];this.data[e][i]=0,this.data[e][r]=a;for(var o=i-1;o>=0;o--)if(0!==this.data[e][o]){if(this.data[e][r]===this.data[e][o]){this.points.push({x:e,y:r}),this.data[e][r--]*=2,t+=this.data[e][r+1],this.data[e][o]=0,i=r;break}var n=this.data[e][o];this.data[e][o]=0,this.data[e][--r]=n,i=r}}this.curScore+=t},e.prototype.turnUp=function(){for(var t=0,e=0;4>e;e++)for(var i=0,r=0;4>i;i++)if(0!==this.data[i][e]){var a=this.data[i][e];this.data[i][e]=0,this.data[r][e]=a;for(var o=i+1;4>o;o++)if(0!==this.data[o][e]){if(this.data[r][e]==this.data[o][e]){this.points.push({x:r,y:e}),this.data[r++][e]*=2,t+=this.data[r-1][e],this.data[o][e]=0,i=r;break}var n=this.data[o][e];this.data[o][e]=0,this.data[++r][e]=n,i=r}}this.curScore+=t},e.prototype.turnDown=function(){for(var t=0,e=0;4>e;e++)for(var i=3,r=3;i>=0;i--)if(0!==this.data[i][e]){var a=this.data[i][e];this.data[i][e]=0,this.data[r][e]=a;for(var o=i-1;o>=0;o--)if(0!==this.data[o][e]){if(this.data[r][e]==this.data[o][e]){this.points.push({x:r,y:e}),this.data[r--][e]*=2,t+=this.data[i-1][e],this.data[o][e]=0,i=r;break}var n=this.data[o][e];this.data[o][e]=0,this.data[--r][e]=n,i=r}}this.curScore+=t},e.prototype.updateCard=function(){this.tfScore.text=this.curScore.toString(),this.points.sort(function(t,e){var i=4*t.x+t.y,r=4*e.x+e.y;return i-r});for(var t=0;4>t;t++)for(var e=0;4>e;e++)if(0==this.points.length)this.cards[t][e].display(this.data[t][e]);else{var i=this.points[0];i.x==t&&i.y==e?(this.cards[t][e].displayWithAnimation(this.data[t][e]),this.points.shift()):this.cards[t][e].display(this.data[t][e])}},e.prototype.isFull=function(t){for(var e=0;4>e;e++)for(var i=0;4>i;i++)if(0===t[e][i])return!1;return!0},e.prototype.isLeftMovable=function(t){for(var e=0;4>e;e++)for(var i=1;4>i;i++)if(0!=t[e][i]&&(0==t[e][i-1]||t[e][i]==t[e][i-1]))return!0;return!1},e.prototype.isRightMovable=function(t){for(var e=0;4>e;e++)for(var i=2;i>=0;i--)if(0!=t[e][i]&&(0==t[e][i+1]||t[e][i]==t[e][i+1]))return!0;return!1},e.prototype.isUpMovable=function(t){for(var e=0;4>e;e++)for(var i=1;4>i;i++)if(0!=t[i][e]&&(0==t[i-1][e]||t[i][e]==t[i-1][e]))return!0;return!1},e.prototype.isDownMovable=function(t){for(var e=0;4>e;e++)for(var i=2;i>=0;i--)if(0!=t[i][e]&&(0==t[i+1][e]||t[i][e]==t[i+1][e]))return!0;return!1},e}(egret.Sprite);__reflect(PlayView.prototype,"PlayView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=16777215,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),Const.SCREEN_WIDTH=this.stage.stageWidth,Const.SCREEN_HEIGHT=this.stage.stageHeight},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.gameScene=new SceneContainer,this.addChild(this.gameScene),this.gameScene.width=Const.SCREEN_WIDTH,this.gameScene.height=Const.SCREEN_HEIGHT},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");